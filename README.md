# Elastic Full Waveform Inversion (FWI) using Physics-Informed GAN & FNO
Imagine peering inside the Earth to predict earthquakes or find hidden resources, like a medical scanner for our planet. This project analyzes seismic waves the vibrations from earthquakes or other sources to map the Earth's subsurface. By transforming complex seismic data into clear images of underground properties, our model helps predict earthquakes, locate oil and gas, and support clean energy solutions.
This repository implements a **Physics-Informed Generative Adversarial Network (GAN)** for **Elastic Full Waveform Inversion (FWI)**. It combines a **U-Net Generator**, a **Wasserstein Discriminator**, and a **Fourier Neural Operator (FNO)** based **Elastic Wave Solver**. The pipeline is designed for reconstructing sub-surface Earth properties (e.g., Vp, Vs, Ï) from seismic waveforms (u_x, u_z).

---

## Key Features

- **Physics-Informed Training** with elastic wave equation residual loss
- **FNO-based Elastic Wave Solver** for waveform simulation
- **GAN Training**: Generator learns Earth model from seismic data; Discriminator ensures realism
- **Multi-parameter Inversion**: Includes P-wave (Vp), S-wave (Vs), density (Ï), Poissonâ€™s ratio (pr), and Youngâ€™s modulus (pm)
- **Fully differentiable** end-to-end pipeline using PyTorch

---

## Folder Structure

```
â””â”€â”€ ğŸ“FWI
    â””â”€â”€ ğŸ“data
        â””â”€â”€ ğŸ“source_info
            â”œâ”€â”€ data_x_i.npy
            â”œâ”€â”€ data_z_i.npy
        â””â”€â”€ ğŸ“velocity_models
            â”œâ”€â”€ density_i.npy
            â”œâ”€â”€ pm_i.npy
            â”œâ”€â”€ vp_i.npy
            â”œâ”€â”€ vs_i.npy
            â”œâ”€â”€ pr_i.npy
    â””â”€â”€ ğŸ“dataloaders
        â””â”€â”€ ğŸ“__pycache__
            â”œâ”€â”€ source_waveforms.cpython-312.pyc
            â”œâ”€â”€ velocity_models.cpython-312.pyc
        â”œâ”€â”€ source_waveforms.py
        â”œâ”€â”€ velocity_models.py
    â””â”€â”€ ğŸ“FNO
        â”œâ”€â”€ fno.py
    â””â”€â”€ ğŸ“GAN
        â””â”€â”€ ğŸ“Discriminator
            â””â”€â”€ ğŸ“__pycache__
                â”œâ”€â”€ discriminator.cpython-312.pyc
            â”œâ”€â”€ discriminator.py
            â”œâ”€â”€ losses.py
        â””â”€â”€ ğŸ“Generator
            â””â”€â”€ ğŸ“__pycache__
                â”œâ”€â”€ generator.cpython-312.pyc
            â”œâ”€â”€ generator.py
            â”œâ”€â”€ losses.py
    â”œâ”€â”€ generator_model.png
    â””â”€â”€ README.md
```

---

## GAN Architecture Overview

```
            Seismic Waveforms (uâ‚“, u_z)
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Generator â”‚â”€â”€â”€> (Vp, Vs, Ï, pr, pm)
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Elastic Wave Solver â”‚ (FNO)
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Predicted Waveform uÌ‚ â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
                      â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ Discriminator (WGAN) â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```
---
###  Input and Output
- **Input**: Seismic waveforms `[B, 10, 1000, 70]` (concatenated `u_x` and `u_z`, each `[B, 5, 1000, 70]`), representing multicomponent seismic data (1000 time points, 70 spatial points).
- **Output**: Subsurface properties `[B, 5, 70, 70]` (\( V_p \), \( V_s \), density, Poissonâ€™s ratio, Youngâ€™s modulus), forming 70x70 spatial grids for geophysical analysis.

---
-**Generator**: A U-Net model maps seismic waveforms (`[B, 10, 1000, 70]`, concatenating `u_x` and `u_z`, each `[B, 5, 1000, 70]`) to subsurface properties (`[B, 5, 70, 70]`: \( V_p \), \( V_s \), density, Poissonâ€™s ratio, Youngâ€™s modulus), trained with adversarial, data misfit (MSE), and PDE residual losses.
-**Discriminator**: A Wasserstein GAN (WGAN) discriminator assesses the realism of synthetic waveforms (generated by the FNO solver) against observed waveforms, using adversarial loss.
-**FNO-based Elastic Wave Solver**: A Fourier Neural Operator simulates elastic wave propagation, generating synthetic waveforms from the generatorâ€™s outputs, enforced by PDE residual loss.

---

### Loss Functions

- **Adversarial Loss (WGAN):**`L_adv = -D(G(z)).mean()`
- **Data Misfit Loss (MSE):**`L_data = MSE(FNO(V_pred), waveform_obs)`
- **Physics Loss (PDE Residual):**`L_pde = || Ï âˆ‚Â²u/âˆ‚tÂ² - âˆ‡Â·Ïƒ ||Â²`
- **Total Generator Loss:**
  `L_total = L_adv + Î»_data * L_data + Î»_pde * L_pde`

---

## Dataset Format

Using E<sup>CFB</sup> dataset from [SMILE Team](https://smileunc.github.io/projects/efwi/datasets)

Each sample consists of:

| File         | Shape            | Description      |
| ------------ | ---------------- | ---------------- |
| data_x_i.npy | [B, 5, 1000, 70] | uâ‚“ waveform     |
| data_z_i.npy | [B, 5, 1000, 70] | u_z waveform     |
| vp_i.npy     | [B, 1, 70, 70]   | P-wave velocity  |
| vs_i.npy     | [B, 1, 70, 70]   | S-wave velocity  |
| density_i.npy    | [B, 1, 70, 70]   | Density          |
| pr_i.npy     | [B, 1, 70, 70]   | Poisson's ratio  |
| pm_i.npy     | [B, 1, 70, 70]   | Youngâ€™s modulus |

Inputs to the Generator: u_x + u_z â†’ [B, 10, 1000, 70]
Outputs from Generator: [B, 5, 70, 70] â†’ input to FNO for waveform reconstruction

---
### Use Cases
The subsurface property images ($ V_p $, $ V_s $, density, etc.) enable multiple applications:

-**Earthquake Prediction**: Identifies fault zones and stress regimes for seismic hazard assessment.
-**Oil and Gas Exploration**: Maps reservoir properties for drilling optimization.
-**Geothermal Energy**: Detects subsurface thermal structures for resource evaluation.
-**Carbon Sequestration**: Assesses storage site integrity using density and elastic moduli.
-**Infrastructure Planning**: Evaluates ground stability for construction by analyzing Poissonâ€™s ratio and Youngâ€™s modulus.
-**The Spectrogram Converter**: (output: [B, 1, 1000, 70]) enhances these by providing frequency-domain features, reducing cycle-skipping in FWI.


---

## To-Do

- [ ] Add Waveform to Spectrogram conversion
- [ ] FNO losses and Additional Physics constraints
- [ ] Implement training loops
- [ ] Add documentation for each module
- [ ] Documentation for usage and examples

---

## References

- [E<sup>FWI</sup>: Multiparameter Benchmark Datasets for Elastic Full Waveform Inversion of Geophysical Properties](https://arxiv.org/abs/2306.12386) Feng et al

- [Revisit Geophysical Imaging In A New View Of Physics-Informed Generative Adversial Learning](https://arxiv.org/abs/2109.11452) Yang et al

- [Fourier Neural Operator Surrogate Model to Predict 3D Seismic Waves Propagation](https://arxiv.org/abs/2304.10242) Lehmann et al

- [Fourier-DeepONet: Fourier-enhanced deep operator networks for full waveform inversion with improved accuracy, generalizability, and robustness](https://arxiv.org/abs/305.17289) Zhu et.al
